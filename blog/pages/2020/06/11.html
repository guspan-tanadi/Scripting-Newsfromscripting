<div class="divDayTitle"><a href="http://scripting.com/2020/06/11.html">Thursday, June 11, 2020</a></div>
<div class="divSingularItem" data-type="outline" data-image="http://scripting.com/images/2019/11/10/fsociety.png"><a name="a211739"></a><img class="imgRightMargin" src="http://scripting.com/images/2019/11/10/fsociety.png" border="0" style="float: right; padding-left: 25px; padding-bottom: 10px; padding-top: 10px; padding-right: 15px;">It's good that the <a href="https://www.reuters.com/article/us-usa-stocks/wall-street-slides-at-open-on-fears-of-second-virus-wave-idUSKBN23I1OR">market corrected</a>. Otherwise it was saying something pretty horrific. That the economy will just sail along with huge unemployment, hunger, disease and death.<span class="spPermaLink"><a href="http://scripting.com/2020/06/11.html#a211739" title="Direct link to this item.">#</a></span></div>
<div class="divSingularItem" data-type="outline"><a name="a135537"></a><a href="https://twitter.com/sfchronicle/status/1270869673303855107">Lakoff says</a> "defund the police" is a terrible slogan. As I've said <a href="http://scripting.com/2020/06/09.html#a181221">myself</a>. Black Lives Matter is brilliant. Impossible to disagree with. But even if you endorse defund the police, you have to immediately explain that isn't literally what it means. <span class="spPermaLink"><a href="http://scripting.com/2020/06/11.html#a135537" title="Direct link to this item.">#</a></span></div>
<div class="divSingularItem" data-type="outline"><a name="a212915"></a>On Twitter, a question. Name something that your mother cooked that was your favorite. At first I was going to reply my mother wasn't a very great cook, but then I <a href="https://twitter.com/davewiner/status/1271192726671962112">remembered</a>. She sent us, my brother and I, cookies at summer camp. They were the best things ever.<span class="spPermaLink"><a href="http://scripting.com/2020/06/11.html#a212915" title="Direct link to this item.">#</a></span></div>
<div class="divSingularItem" data-type="outline"><a name="a131055"></a>One of my servers was down at least since midnight. Sorry if you've had trouble reaching <a href="http://littleoutliner.com/">LO2</a> and many of the static sites. Operator error. <span class="spPermaLink"><a href="http://scripting.com/2020/06/11.html#a131055" title="Direct link to this item.">#</a></span></div>
<div class="divSingularItem" data-type="outline"><a name="a125413"></a>I found the <a href="https://www.polywood.com/chaise-with-arms.html">patio lounge chairs</a> I want. Reasonably priced. Sturdy. Attractive. Only problem is they take a long time to get here. 8 weeks. By that time summer will almost be over. (Update: My friend Peter Politi found the chairs on the Lowe's website at a good price for delivery in 8 days. Problem solved.)<span class="spPermaLink"><a href="http://scripting.com/2020/06/11.html#a125413" title="Direct link to this item.">#</a></span></div>
<div class="divSingularItem" data-type="outline"><a name="a144031"></a>Feature <a href="https://twitter.com/davewiner/status/1271087957777305604">request</a> for Twitter.<span class="spPermaLink"><a href="http://scripting.com/2020/06/11.html#a144031" title="Direct link to this item.">#</a></span></div>
<div class="divSingularItem" data-type="outline" data-urlvideo="https://www.youtube.com/watch?v=BGLGzRXY5Bw"><a name="a154551"></a>Beatles: <a href="https://www.youtube.com/watch?v=BGLGzRXY5Bw">Revolution</a>.<span class="spPermaLink"><a href="http://scripting.com/2020/06/11.html#a154551" title="Direct link to this item.">#</a></span></div>
<div class="divSingularItem" data-type="outline" data-inlineImage="http://scripting.com/images/2020/06/11/racism.png"><div class="divInlineImage"><a name="a232728"></a><center><img class="imgInline" src="http://scripting.com/images/2020/06/11/racism.png"></center>American racism is a <a href="https://twitter.com/iLURVhistory/status/1270933462325907457">product</a> of British colonialism. <span class="spPermaLink"><a href="http://scripting.com/2020/06/11.html#a232728" title="Direct link to this item.">#</a></span></div></div>
<div class="divTitledItem">
	<div class="divTitle"><a name="a131902"></a><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode"><span class="spTitleLink">Defensive driving in code</a></a><span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode" title="Direct link to this item.">#</a></span></div>
	<ul class="ulLevel0">
	<li><a name="a131908"></a>Continuing the example from the <a href="http://scripting.com/2020/06/07/140541.html?title=aCaseStudyInReadableCode">previous case study</a>. The routine, pad, takes three parameters, a string or something that can be coerced to a string, a character to pad with, and the number of places to pad to. So <i>pad (8, "0", 4)</i> returns a string whose value is 0008. It's useful for neat tabular displays.  <span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a131908" title="Direct link to this item.">#</a></span></li>
	<li data-flCodeSubs="true"><a name="a132034"></a>In an app I'm working on, I call pad a lot. Then, while testing it in a new environment, I got an error message from the JavaScript runtime:<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a132034" title="Direct link to this item.">#</a></span></li>
	<ul class="ulLevel1 ulCodeSubs">
	<li><a name="a132105"></a>TypeError: Cannot read property 'toString' of undefined.<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a132105" title="Direct link to this item.">#</a></span></li>
	</ul>

	<li data-flCodeSubs="true"><a name="a132133"></a>Looking at the stack, the error was in the first line of pad.  <span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a132133" title="Direct link to this item.">#</a></span></li>
	<ul class="ulLevel1 ulCodeSubs">
	<li><a name="a132146"></a>var s = val.toString ();<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a132146" title="Direct link to this item.">#</a></span></li>
	</ul>

	<li><a name="a132202"></a>I conclude that val is undefined in one of the many calls. <span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a132202" title="Direct link to this item.">#</a></span></li>
	<li><a name="a132229"></a>The question -- should I find the place I called it with undefined and add logic to not call pad in that case, or should I add the test in pad, and return something reasonable when val is undefined?<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a132229" title="Direct link to this item.">#</a></span></li>
	<li><a name="a132312"></a>Now we get to the point of this case study.<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a132312" title="Direct link to this item.">#</a></span></li>
	<li><a name="a132329"></a>Changing a core routine like pad is tricky. If you change its functionality, you potentially break code that calls it. If it's been around a while, who knows all the places it has been called. However in this case, that's not an issue, because any call that has undefined as the value of the first parameter is going to fail. So it's already broken, therefore you can't break it and therefore it's okay to fix it. <span class="spOldSchoolEmoji">ðŸš€</span><span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a132329" title="Direct link to this item.">#</a></span></li>
	<li><a name="a132444"></a>Then the question is if it's <i>desirable</i> to fix it in pad, or in the place that calls it that causes the app to fail. For me that's a no-brainer. It would clutter up every call if we don't put it in the function. The whole point of factoring like this is to trade off a tiny bit of time for space and reduced complexity. Factoring is a good thing, and you should do it whenever it's responsible. Remember what <a href="http://www.gurteen.com/gurteen/gurteen.nsf/id/X00063BF6/">Einstein</a> said. Basically factoring is good, but don't do too much. <span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a132444" title="Direct link to this item.">#</a></span></li>
	<li><a name="a133010"></a>I call this coding technique <i>defensive driving. </i>It's something you do in case the other driver (the caller) screws up. You want to prevent the accident. Most of the time it won't accomplish anything, but when it does, it saves you from a crash. One less thing to worry about.<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a133010" title="Direct link to this item.">#</a></span></li>
	<li data-flCodeSubs="true"><a name="a132617"></a>So here's the new version of pad, with the defensive driving code added:<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a132617" title="Direct link to this item.">#</a></span></li>
	<ul class="ulLevel1 ulCodeSubs">
	<li><a name="a140924"></a>function pad (val, withchar, ctplaces) {<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a140924" title="Direct link to this item.">#</a></span></li>
	<ul class="ulLevel2">
	<li><a name="a132751"></a>var s = (val === undefined) ? "" : val.toString ();<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a132751" title="Direct link to this item.">#</a></span></li>
	<li><a name="a140932"></a>while (s.length < ctplaces) {<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a140932" title="Direct link to this item.">#</a></span></li>
	<ul class="ulLevel3">
	<li><a name="aNaNNaNNaN"></a>s = withchar + s;<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#aNaNNaNNaN" title="Direct link to this item.">#</a></span></li>
	<li><a name="aNaNNaNNaN"></a>}<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#aNaNNaNNaN" title="Direct link to this item.">#</a></span></li>
	</ul>

	<li><a name="aNaNNaNNaN"></a>return (s);<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#aNaNNaNNaN" title="Direct link to this item.">#</a></span></li>
	<li><a name="aNaNNaNNaN"></a>}<span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#aNaNNaNNaN" title="Direct link to this item.">#</a></span></li>
	</ul>

	</ul>

	<li><a name="a133757"></a>It makes <i>pad</i> a little more complicated -- a fact of life. Production code is rarely as simple as demo code because it has to deal with all the crap that gets thrown at it. Defensive driving is how you deal with that, the same as in driving a car or riding a bike in traffic. You never know what the other idiot is going to do. <span class="spOldSchoolEmoji">ðŸ˜„</span><span class="spPermaLink"><a href="http://scripting.com/2020/06/11/131902.html?title=defensiveDrivingInCode#a133757" title="Direct link to this item.">#</a></span></li>
	</ul>

	</div>
